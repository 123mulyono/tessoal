<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Ujian Online - EduTest</title>
    <script src="https://cdn.tailwindcss.com">
let examQuestions = {};
let questions = [];
let currentQuestion = 0;
let answers = [];
let currentExam = "";

// Load soal.json
fetch('soal.json')
  .then(res => res.json())
  .then(data => {
    // Kelompokkan berdasarkan kategori
    examQuestions = data.reduce((acc, soal) => {
      const kategori = soal.kategori || "umum";
      if (!acc[kategori]) acc[kategori] = [];
      acc[kategori].push(soal);
      return acc;
    }, {});
  })
  .catch(err => {
    alert("Gagal memuat soal.");
    console.error(err);
  });

// Menampilkan soal
function startExam(subject) {
  currentExam = subject;
  questions = examQuestions[subject];
  if (!questions || questions.length === 0) {
    alert("Soal belum tersedia untuk kategori ini.");
    return;
  }
  answers = new Array(questions.length);
  currentQuestion = 0;
  showPage("exam");
  renderQuestion();
}

// Render soal
function renderQuestion() {
  const q = questions[currentQuestion];
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  const el = document.createElement("div");
  el.classList = "space-y-4";

  el.innerHTML += `<div class='font-semibold'>${q.question}</div>`;
  if (q.image) el.innerHTML += `<img src="${q.image}" class="w-40">`;

  if (q.type === "single") {
    q.options.forEach((opt, idx) => {
      el.innerHTML += \`
        <label class="block">
          <input type="radio" name="answer" value="\${idx}" onchange="answers[\${currentQuestion}] = parseInt(this.value)" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "multiple") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    q.options.forEach((opt, idx) => {
      const checked = answers[currentQuestion].includes(idx) ? "checked" : "";
      el.innerHTML += \`
        <label class="block">
          <input type="checkbox" value="\${idx}" \${checked}
            onchange="toggleCheckboxAnswer(\${idx})" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "matrix") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    let table = "<table class='table-auto border w-full text-sm'><thead><tr><th class='border px-2'>Pernyataan</th>";
    q.options.forEach(opt => {
      table += \`<th class='border px-2'>\${opt}</th>\`;
    });
    table += "</tr></thead><tbody>";
    q.statements.forEach((stmt, rowIdx) => {
      table += \`<tr><td class='border px-2'>\${stmt}</td>\`;
      q.options.forEach((opt, colIdx) => {
        table += \`
          <td class='border px-2 text-center'>
            <input type="radio" name="matrix-\${rowIdx}" value="\${colIdx}" 
              onchange="setMatrixAnswer(\${currentQuestion}, \${rowIdx}, \${colIdx})"
              \${answers[currentQuestion][rowIdx] === colIdx ? "checked" : ""}>
          </td>\`;
      });
      table += "</tr>";
    });
    table += "</tbody></table>";
    el.innerHTML += table;
  }

  container.appendChild(el);
}

function toggleCheckboxAnswer(idx) {
  const current = answers[currentQuestion] || [];
  const i = current.indexOf(idx);
  if (i > -1) {
    current.splice(i, 1);
  } else {
    current.push(idx);
  }
  answers[currentQuestion] = current;
}

function setMatrixAnswer(qIdx, rowIdx, colIdx) {
  answers[qIdx][rowIdx] = colIdx;
}

// Navigasi
function nextQuestion() {
  if (currentQuestion < questions.length - 1) {
    currentQuestion++;
    renderQuestion();
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    renderQuestion();
  }
}

// Submit dan nilai
function submitExam() {
  let totalPoints = 0;
  let earnedPoints = 0;

  questions.forEach((question, index) => {
    const skor = question.score || 1;
    totalPoints += skor;
    const jawaban = answers[index];

    if (question.type === "single") {
      if (jawaban === question.answer) earnedPoints += skor;
    } else if (question.type === "multiple") {
      if (
        Array.isArray(jawaban) &&
        Array.isArray(question.answer) &&
        jawaban.length === question.answer.length &&
        jawaban.every(val => question.answer.includes(val))
      ) {
        earnedPoints += skor;
      }
    } else if (question.type === "matrix") {
      let benar = 0;
      if (jawaban) {
        question.answer.forEach((kunci, i) => {
          if (jawaban[i] === kunci) benar++;
        });
      }
      const skorPerBaris = skor / question.answer.length;
      earnedPoints += benar * skorPerBaris;
    }
  });

  document.getElementById("totalPoints").textContent = totalPoints;
  document.getElementById("earnedPoints").textContent = earnedPoints.toFixed(2);
  showPage("results");
}

</script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .slide-in {
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          transform: translateX(-20px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .drop-zone:hover {
        border-color: #3b82f6 !important;
        background-color: #eff6ff !important;
      }
      .dragging {
        opacity: 0.5;
        transform: rotate(5deg);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
        <div class="text-center mb-8">
          <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-white text-2xl font-bold">üìö</span>
          </div>
          <h1 class="text-2xl font-bold text-gray-800">EduTest Online</h1>
          <p class="text-gray-600 mt-2">Sistem Ujian Online</p>
        </div>

        <form id="loginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
            <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username" required />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
            <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password" required />
          </div>

          <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">Masuk</button>
        </form>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
          <p class="text-sm text-gray-600 font-medium mb-2">Demo Login:</p>
          <p class="text-xs text-gray-500">Username: murid1 | Password: 123456</p>
          <p class="text-xs text-gray-500">Username: murid2 | Password: 123456</p>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
      <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <span class="text-2xl">üìö</span>
              <span class="ml-2 text-xl font-bold text-gray-800">EduTest</span>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-gray-600">Halo, <span id="studentName" class="font-medium"></span></span>
              <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">Keluar</button>
            </div>
          </div>
        </div>
      </nav>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="fade-in">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard Ujian</h2>
          <p class="text-gray-600 mb-8">Pilih ujian yang ingin Anda kerjakan</p>

          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Ujian Card 1 -->
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 slide-in">
              <div class="flex items-center mb-4">
                <div class="bg-green-100 p-3 rounded-lg">
                  <span class="text-2xl">üìù</span>
                </div>
                <div class="ml-4">
                  <h3 class="font-bold text-gray-800">Matematika Dasar</h3>
                  <p class="text-sm text-gray-500">25 Soal ‚Ä¢ 60 Menit</p>
                </div>
              </div>
              <p class="text-gray-600 text-sm mb-4">Ujian matematika dasar meliputi aljabar, geometri, dan statistik.</p>
              <div class="flex justify-between items-center">
                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium">Tersedia</span>
                <button onclick="startExam('math')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Mulai Ujian</button>
              </div>
            </div>

            <!-- Ujian Card 2 -->
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 slide-in">
              <div class="flex items-center mb-4">
                <div class="bg-blue-100 p-3 rounded-lg">
                  <span class="text-2xl">üî¨</span>
                </div>
                <div class="ml-4">
                  <h3 class="font-bold text-gray-800">Sains Terpadu</h3>
                  <p class="text-sm text-gray-500">20 Soal ‚Ä¢ 45 Menit</p>
                </div>
              </div>
              <p class="text-gray-600 text-sm mb-4">Ujian sains meliputi fisika, kimia, dan biologi dasar.</p>
              <div class="flex justify-between items-center">
                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium">Tersedia</span>
                <button onclick="startExam('science')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Mulai Ujian</button>
              </div>
            </div>

            <!-- Ujian Card 3 -->
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 slide-in">
              <div class="flex items-center mb-4">
                <div class="bg-purple-100 p-3 rounded-lg">
                  <span class="text-2xl">üìñ</span>
                </div>
                <div class="ml-4">
                  <h3 class="font-bold text-gray-800">Bahasa Indonesia</h3>
                  <p class="text-sm text-gray-500">30 Soal ‚Ä¢ 90 Menit</p>
                </div>
              </div>
              <p class="text-gray-600 text-sm mb-4">Ujian bahasa Indonesia meliputi tata bahasa dan pemahaman teks.</p>
              <div class="flex justify-between items-center">
                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-medium">Segera</span>
                <button disabled class="bg-gray-300 text-gray-500 px-4 py-2 rounded-lg cursor-not-allowed">Belum Tersedia</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Exam Page -->
    <div id="examPage" class="hidden min-h-screen bg-gray-50">
      <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <span class="text-xl font-bold text-gray-800" id="examTitle">Ujian Matematika Dasar</span>
            </div>
            <div class="flex items-center space-x-4">
              <div class="bg-blue-100 px-4 py-2 rounded-lg">
                <span class="text-blue-800 font-medium">Waktu: <span id="timer">60:00</span></span>
              </div>
              <button onclick="submitExam()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">Selesai</button>
            </div>
          </div>
        </div>
      </nav>

      <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="flex gap-8">
          <!-- Question Navigation -->
          <div class="w-64 bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-bold text-gray-800 mb-4">Navigasi Soal</h3>
            <div class="grid grid-cols-5 gap-2" id="questionNav">
              <!-- Navigation buttons will be generated here -->
            </div>
            <div class="mt-6 space-y-2 text-sm">
              <div class="flex items-center">
                <div class="w-4 h-4 bg-green-500 rounded mr-2"></div>
                <span>Sudah dijawab</span>
              </div>
              <div class="flex items-center">
                <div class="w-4 h-4 bg-yellow-500 rounded mr-2"></div>
                <span>Sedang dikerjakan</span>
              </div>
              <div class="flex items-center">
                <div class="w-4 h-4 bg-gray-300 rounded mr-2"></div>
                <span>Belum dijawab</span>
              </div>
            </div>
          </div>

          <!-- Question Content -->
          <div class="flex-1 bg-white rounded-xl shadow-lg p-8">
            <div id="questionContent">
              <!-- Question content will be loaded here -->
            </div>

            <div class="flex justify-between mt-8">
              <button id="prevBtn" onclick="previousQuestion()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-200">‚Üê Sebelumnya</button>
              <button id="nextBtn" onclick="nextQuestion()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Selanjutnya ‚Üí</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="hidden min-h-screen">
      <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <span class="text-2xl">üìö</span>
              <span class="ml-2 text-xl font-bold text-gray-800">EduTest</span>
            </div>
            <button onclick="backToDashboard()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">Kembali ke Dashboard</button>
          </div>
        </div>
      </nav>

      <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="text-center mb-8 fade-in">
          <div class="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-4xl">üéâ</span>
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Ujian Selesai!</h2>
          <p class="text-gray-600">Terima kasih telah mengerjakan ujian</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
          <h3 class="text-xl font-bold text-gray-800 mb-6">Ringkasan Hasil</h3>
          <div class="grid md:grid-cols-3 gap-6">
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600" id="totalQuestions">25</div>
              <div class="text-sm text-gray-600">Total Soal</div>
            </div>
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600" id="answeredQuestions">23</div>
              <div class="text-sm text-gray-600">Terjawab</div>
            </div>
            <div class="text-center p-4 bg-purple-50 rounded-lg">
              <div class="text-2xl font-bold text-purple-600" id="totalPoints">25</div>
              <div class="text-sm text-gray-600">Total Poin</div>
            </div>
            <div class="text-center p-4 bg-yellow-50 rounded-lg">
              <div class="text-2xl font-bold text-yellow-600" id="timeUsed">45:30</div>
              <div class="text-sm text-gray-600">Waktu Terpakai</div>
            </div>
          </div>
        </div>

        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div class="flex items-center">
            <span class="text-yellow-600 text-xl mr-3">‚ö†Ô∏è</span>
            <div>
              <h4 class="font-medium text-yellow-800">Prototype Demo</h4>
              <p class="text-sm text-yellow-700">Ini adalah demo. Dalam versi lengkap, hasil akan tersimpan di database dan bisa diunduh oleh guru.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sample questions data
      const examQuestions = {
        math: [
          {
            id: 1,
            type: "single",
            question: "Berapakah hasil dari 15 + 28?",
            options: ["41", "42", "43", "44"],
            image: null,
          },
          {
            id: 2,
            type: "multiple",
            question: "Manakah dari bilangan berikut yang merupakan bilangan prima? (Pilih semua yang benar)",
            options: ["2", "4", "7", "9", "11"],
            image: null,
          },
          {
            id: 3,
            type: "radio",
            question: "Jika x + 5 = 12, maka nilai x adalah...",
            options: [
              { text: "5", feedback: "Salah. Coba hitung lagi: x = 12 - 5" },
              { text: "6", feedback: "Benar! x = 12 - 5 = 7" },
              { text: "7", feedback: "Benar! x = 12 - 5 = 7" },
              { text: "8", feedback: "Salah. x = 12 - 5 = 7" },
            ],
            image: null,
          },
          {
            id: 4,
            type: "matrix",
            question: "Klik pilihan Perlu atau Tidak Perlu untuk setiap pernyataan sesuai isi teks!",
            statements: [
              "Gambar makanan atau minuman dari rempah.",
              "Gambar penyakit yang disebabkan rempah.",
              "Penjelasan cara menanam rempah-rempah.",
              "Daftar harga rempah di pasar tradisional.",
              "Manfaat kesehatan dari mengonsumsi rempah.",
            ],
            options: ["Perlu", "Tidak Perlu"],
            image: null,
          },
          {
            id: 5,
            type: "matrix",
            question: "Tentukan apakah pernyataan berikut Benar atau Salah berdasarkan konsep matematika:",
            statements: [
              "Bilangan prima adalah bilangan yang hanya memiliki dua faktor.",
              "Hasil dari 0 dibagi dengan bilangan apapun adalah 0.",
              "Segitiga sama sisi memiliki tiga sudut yang sama besar.",
              "Luas lingkaran dihitung dengan rumus œÄ √ó diameter.",
              "Dalam sistem desimal, angka 10 adalah bilangan prima.",
            ],
            options: ["Benar", "Salah"],
            image: null,
          },
          {
            id: 6,
            type: "matching",
            question: "Pasangkan bangun datar dengan rumus luasnya:",
            leftColumn: ["Persegi", "Persegi Panjang", "Segitiga", "Lingkaran"],
            rightColumn: ["s √ó s", "p √ó l", "¬Ω √ó a √ó t", "œÄ √ó r¬≤", "a + b + c", "2 √ó (p + l)"],
            image: null,
          },
          {
            id: 7,
            type: "radio_with_image",
            question: "Perhatikan gambar segitiga di bawah ini. Berapakah keliling segitiga tersebut?",
            options: [
              { text: "12 cm", feedback: "Benar! Keliling = 3 + 4 + 5 = 12 cm" },
              { text: "15 cm", feedback: "Salah. Keliling adalah jumlah semua sisi" },
              { text: "10 cm", feedback: "Salah. Hitung kembali: 3 + 4 + 5" },
              { text: "20 cm", feedback: "Salah. Keliling = 3 + 4 + 5 = 12 cm" },
            ],
            image:
              "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cG9seWdvbiBwb2ludHM9IjUwLDEyMCAxNTAsMTIwIDEwMCw0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8dGV4dCB4PSI3NSIgeT0iMTM1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiMzMzMiPjMgY208L3RleHQ+CiAgPHRleHQgeD0iMTI1IiB5PSI4NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMzMzIj40IGNtPC90ZXh0PgogIDx0ZXh0IHg9IjY1IiB5PSI4NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMzMzIj41IGNtPC90ZXh0Pgo8L3N2Zz4=",
          },
        ],
        science: [
          {
            id: 1,
            type: "single",
            question: "Planet terdekat dengan Matahari adalah...",
            options: ["Venus", "Merkurius", "Mars", "Bumi"],
            image: null,
          },
          {
            id: 2,
            type: "multiple",
            question: "Manakah yang termasuk gas mulia? (Pilih semua yang benar)",
            options: ["Helium", "Oksigen", "Neon", "Nitrogen", "Argon"],
            image: null,
          },
          {
            id: 3,
            type: "single",
            question: "Proses fotosintesis terjadi di bagian tumbuhan yang disebut...",
            options: ["Akar", "Batang", "Daun", "Bunga"],
            image: null,
          },
        ],
      };

      let currentExam = null;
      let currentQuestion = 0;
      let answers = {};
      let timeLeft = 3600; // 60 minutes in seconds
      let timerInterval = null;

      function getQuestionTypeLabel(type) {
        const labels = {
          single: "Pilihan Tunggal",
          multiple: "Pilihan Ganda",
          radio: "Radio Button",
          matrix: "Matrix/Drag Drop",
          matching: "Mencocokkan",
          radio_with_image: "Radio + Gambar",
        };
        return labels[type] || "Tidak Diketahui";
      }

      // Login functionality
      document.getElementById("loginForm").addEventListener("submit", function (e) {
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  fetch("users.json")
    .then((res) => res.json())
    .then((users) => {
      const user = users.find(u => u.username === username && u.password === password);
      if (user) {
        document.getElementById("studentName").textContent = username;
        showPage("dashboard");
      } else {
        alert("Username atau password salah!");
      }
    })
    .catch(err => {
      alert("Gagal memuat users.json");
      console.error(err);
    });
});

      function showPage(pageId) {
        const pages = ["loginPage", "dashboard", "examPage", "resultsPage"];
        pages.forEach((page) => {
          document.getElementById(page).classList.add("hidden");
        });
        document.getElementById(pageId).classList.remove("hidden");
      }

      function logout() {
        showPage("loginPage");
        document.getElementById("loginForm").reset();
      }

      function startExam(examType) {
        currentExam = examType;
        currentQuestion = 0;
        answers = {};

        const examTitles = {
          math: "Ujian Matematika Dasar",
          science: "Ujian Sains Terpadu",
        };

        document.getElementById("examTitle").textContent = examTitles[examType];
        generateQuestionNavigation();
        loadQuestion();
        startTimer();
        showPage("examPage");
      }

      function generateQuestionNavigation() {
        const nav = document.getElementById("questionNav");
        nav.innerHTML = "";
        const questions = examQuestions[currentExam];

        questions.forEach((q, index) => {
          const btn = document.createElement("button");
          btn.textContent = index + 1;
          btn.className = "w-8 h-8 rounded text-sm font-medium transition duration-200";
          btn.onclick = () => goToQuestion(index);
          updateNavButton(btn, index);
          nav.appendChild(btn);
        });
      }

      function updateNavButton(btn, index) {
        if (answers[index] !== undefined) {
          btn.className = "w-8 h-8 rounded text-sm font-medium bg-green-500 text-white";
        } else if (index === currentQuestion) {
          btn.className = "w-8 h-8 rounded text-sm font-medium bg-yellow-500 text-white";
        } else {
          btn.className = "w-8 h-8 rounded text-sm font-medium bg-gray-300 text-gray-700 hover:bg-gray-400";
        }
      }

      function loadQuestion() {
        const questions = examQuestions[currentExam];
        const question = questions[currentQuestion];
        const content = document.getElementById("questionContent");

        let html = `
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-800">Soal ${currentQuestion + 1} dari ${questions.length}</h3>
                        <div class="flex items-center space-x-2">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">1 Poin</span>
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">${getQuestionTypeLabel(question.type)}</span>
                        </div>
                    </div>
                    <p class="text-gray-700 text-lg mb-6">${question.question}</p>
                </div>
            `;

        // Add image if present
        if (question.image) {
          html += `<div class="mb-6 text-center"><img src="${question.image}" alt="Gambar soal" class="mx-auto max-w-md border rounded-lg shadow-sm"></div>`;
        }

        if (question.type === "single") {
          html += '<div class="space-y-3">';
          question.options.forEach((option, index) => {
            const checked = answers[currentQuestion] === index ? "checked" : "";
            html += `
                        <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="answer" value="${index}" ${checked} onchange="saveAnswer(${index})" class="mr-3">
                            <span>${option}</span>
                        </label>
                    `;
          });
          html += "</div>";
        } else if (question.type === "radio" || question.type === "radio_with_image") {
          html += '<div class="space-y-3">';
          question.options.forEach((option, index) => {
            const checked = answers[currentQuestion] === index ? "checked" : "";
            html += `
                        <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition duration-200">
                            <input type="radio" name="answer" value="${index}" ${checked} onchange="saveRadioAnswer(${index})" class="mr-3 text-blue-600">
                            <span class="flex-1">${option.text}</span>
                        </label>
                    `;
          });
          html += "</div>";

          // Show feedback if answer is selected
          if (answers[currentQuestion] !== undefined) {
            const selectedOption = question.options[answers[currentQuestion]];
            html += `
                        <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                            <p class="text-blue-800"><strong>Feedback:</strong> ${selectedOption.feedback}</p>
                        </div>
                    `;
          }
        } else if (question.type === "multiple") {
          html += '<div class="space-y-3">';
          question.options.forEach((option, index) => {
            const checked = answers[currentQuestion] && answers[currentQuestion].includes(index) ? "checked" : "";
            html += `
                        <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" value="${index}" ${checked} onchange="saveMultipleAnswer(${index})" class="mr-3">
                            <span>${option}</span>
                        </label>
                    `;
          });
          html += "</div>";
        } else if (question.type === "matrix") {
          // Table-style matrix with radio buttons
          html += `
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300 bg-white rounded-lg shadow-sm">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="border border-gray-300 px-4 py-3 text-left font-medium text-gray-700">Pernyataan</th>
                `;

          question.options.forEach((option) => {
            html += `<th class="border border-gray-300 px-4 py-3 text-center font-medium text-gray-700 min-w-[120px]">${option}</th>`;
          });

          html += `
                                </tr>
                            </thead>
                            <tbody>
                `;

          question.statements.forEach((statement, rowIndex) => {
            html += `
                        <tr class="hover:bg-gray-50">
                            <td class="border border-gray-300 px-4 py-4 text-gray-700">${statement}</td>
                    `;

            question.options.forEach((option, colIndex) => {
              const checked = answers[currentQuestion] && answers[currentQuestion][rowIndex] === colIndex ? "checked" : "";
              html += `
                            <td class="border border-gray-300 px-4 py-4 text-center">
                                <input type="radio" name="matrix_${rowIndex}" value="${colIndex}" ${checked} 
                                       onchange="saveMatrixAnswer(${rowIndex}, ${colIndex})" 
                                       class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            </td>
                        `;
            });

            html += "</tr>";
          });

          html += `
                            </tbody>
                        </table>
                    </div>
                `;
        } else if (question.type === "matching") {
          html += '<div class="space-y-4">';
          question.leftColumn.forEach((leftItem, index) => {
            html += `
                        <div class="flex items-center space-x-4 p-4 border rounded-lg bg-gray-50">
                            <div class="w-1/3 font-medium">${leftItem}</div>
                            <div class="w-2/3">
                                <select onchange="saveMatchingAnswer(${index}, this.value)" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih jawaban...</option>
                `;
            question.rightColumn.forEach((rightItem, rightIndex) => {
              const selected = answers[currentQuestion] && answers[currentQuestion][index] === rightIndex ? "selected" : "";
              html += `<option value="${rightIndex}" ${selected}>${rightItem}</option>`;
            });
            html += `
                                </select>
                            </div>
                        </div>
                    `;
          });
          html += "</div>";
        }

        content.innerHTML = html;
        updateNavigationButtons();
        generateQuestionNavigation();
      }

      function saveAnswer(value) {
        answers[currentQuestion] = value;
        generateQuestionNavigation();
      }

      function saveRadioAnswer(value) {
        answers[currentQuestion] = value;
        generateQuestionNavigation();
        // Reload question to show feedback
        setTimeout(() => loadQuestion(), 100);
      }

      function saveMultipleAnswer(value) {
        if (!answers[currentQuestion]) {
          answers[currentQuestion] = [];
        }
        const index = answers[currentQuestion].indexOf(value);
        if (index > -1) {
          answers[currentQuestion].splice(index, 1);
        } else {
          answers[currentQuestion].push(value);
        }
        generateQuestionNavigation();
      }

      function saveMatrixAnswer(rowIndex, colIndex) {
        if (!answers[currentQuestion]) {
          answers[currentQuestion] = {};
        }
        answers[currentQuestion][rowIndex] = colIndex;
        generateQuestionNavigation();
      }

      function saveMatchingAnswer(questionIndex, value) {
        if (!answers[currentQuestion]) {
          answers[currentQuestion] = {};
        }
        answers[currentQuestion][questionIndex] = parseInt(value);
        generateQuestionNavigation();
      }

      // Drag and drop functions for matrix questions
      function allowDrop(ev) {
        ev.preventDefault();
        ev.target.classList.add("border-blue-400", "bg-blue-50");
      }

      function dragAnswer(ev, answer) {
        ev.dataTransfer.setData("text", answer);
      }

      function dropAnswer(ev, questionIndex) {
        ev.preventDefault();
        const answer = ev.dataTransfer.getData("text");

        if (!answers[currentQuestion]) {
          answers[currentQuestion] = {};
        }
        answers[currentQuestion][questionIndex] = answer;

        ev.target.innerHTML = `<span class="text-sm font-medium text-blue-600">${answer}</span>`;
        ev.target.classList.remove("border-blue-400", "bg-blue-50");
        generateQuestionNavigation();
      }

      function goToQuestion(index) {
        currentQuestion = index;
        loadQuestion();
      }

      function previousQuestion() {
        if (currentQuestion > 0) {
          currentQuestion--;
          loadQuestion();
        }
      }

      function nextQuestion() {
        const questions = examQuestions[currentExam];
        if (currentQuestion < questions.length - 1) {
          currentQuestion++;
          loadQuestion();
        }
      }

      function updateNavigationButtons() {
        const questions = examQuestions[currentExam];
        document.getElementById("prevBtn").disabled = currentQuestion === 0;
        document.getElementById("nextBtn").disabled = currentQuestion === questions.length - 1;
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          timeLeft--;
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          document.getElementById("timer").textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          if (timeLeft <= 0) {
            submitExam();
          }
        }, 1000);
      }

      function submitExam() {
        clearInterval(timerInterval);

        const questions = examQuestions[currentExam];
        const answeredCount = Object.keys(answers).length;
        const totalPoints = questions.length; // Each question is worth 1 point
        const totalTime = currentExam === "math" ? 3600 : 2700; // 60 or 45 minutes
        const timeUsed = totalTime - timeLeft;
        const timeUsedMinutes = Math.floor(timeUsed / 60);
        const timeUsedSeconds = timeUsed % 60;

        document.getElementById("totalQuestions").textContent = questions.length;
        document.getElementById("answeredQuestions").textContent = answeredCount;
        document.getElementById("totalPoints").textContent = totalPoints;
        document.getElementById("timeUsed").textContent = `${timeUsedMinutes}:${timeUsedSeconds.toString().padStart(2, "0")}`;

        showPage("resultsPage");
      }

      function backToDashboard() {
        showPage("dashboard");
      }
    
let examQuestions = {};
let questions = [];
let currentQuestion = 0;
let answers = [];
let currentExam = "";

// Load soal.json
fetch('soal.json')
  .then(res => res.json())
  .then(data => {
    // Kelompokkan berdasarkan kategori
    examQuestions = data.reduce((acc, soal) => {
      const kategori = soal.kategori || "umum";
      if (!acc[kategori]) acc[kategori] = [];
      acc[kategori].push(soal);
      return acc;
    }, {});
  })
  .catch(err => {
    alert("Gagal memuat soal.");
    console.error(err);
  });

// Menampilkan soal
function startExam(subject) {
  currentExam = subject;
  questions = examQuestions[subject];
  if (!questions || questions.length === 0) {
    alert("Soal belum tersedia untuk kategori ini.");
    return;
  }
  answers = new Array(questions.length);
  currentQuestion = 0;
  showPage("exam");
  renderQuestion();
}

// Render soal
function renderQuestion() {
  const q = questions[currentQuestion];
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  const el = document.createElement("div");
  el.classList = "space-y-4";

  el.innerHTML += `<div class='font-semibold'>${q.question}</div>`;
  if (q.image) el.innerHTML += `<img src="${q.image}" class="w-40">`;

  if (q.type === "single") {
    q.options.forEach((opt, idx) => {
      el.innerHTML += \`
        <label class="block">
          <input type="radio" name="answer" value="\${idx}" onchange="answers[\${currentQuestion}] = parseInt(this.value)" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "multiple") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    q.options.forEach((opt, idx) => {
      const checked = answers[currentQuestion].includes(idx) ? "checked" : "";
      el.innerHTML += \`
        <label class="block">
          <input type="checkbox" value="\${idx}" \${checked}
            onchange="toggleCheckboxAnswer(\${idx})" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "matrix") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    let table = "<table class='table-auto border w-full text-sm'><thead><tr><th class='border px-2'>Pernyataan</th>";
    q.options.forEach(opt => {
      table += \`<th class='border px-2'>\${opt}</th>\`;
    });
    table += "</tr></thead><tbody>";
    q.statements.forEach((stmt, rowIdx) => {
      table += \`<tr><td class='border px-2'>\${stmt}</td>\`;
      q.options.forEach((opt, colIdx) => {
        table += \`
          <td class='border px-2 text-center'>
            <input type="radio" name="matrix-\${rowIdx}" value="\${colIdx}" 
              onchange="setMatrixAnswer(\${currentQuestion}, \${rowIdx}, \${colIdx})"
              \${answers[currentQuestion][rowIdx] === colIdx ? "checked" : ""}>
          </td>\`;
      });
      table += "</tr>";
    });
    table += "</tbody></table>";
    el.innerHTML += table;
  }

  container.appendChild(el);
}

function toggleCheckboxAnswer(idx) {
  const current = answers[currentQuestion] || [];
  const i = current.indexOf(idx);
  if (i > -1) {
    current.splice(i, 1);
  } else {
    current.push(idx);
  }
  answers[currentQuestion] = current;
}

function setMatrixAnswer(qIdx, rowIdx, colIdx) {
  answers[qIdx][rowIdx] = colIdx;
}

// Navigasi
function nextQuestion() {
  if (currentQuestion < questions.length - 1) {
    currentQuestion++;
    renderQuestion();
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    renderQuestion();
  }
}

// Submit dan nilai
function submitExam() {
  let totalPoints = 0;
  let earnedPoints = 0;

  questions.forEach((question, index) => {
    const skor = question.score || 1;
    totalPoints += skor;
    const jawaban = answers[index];

    if (question.type === "single") {
      if (jawaban === question.answer) earnedPoints += skor;
    } else if (question.type === "multiple") {
      if (
        Array.isArray(jawaban) &&
        Array.isArray(question.answer) &&
        jawaban.length === question.answer.length &&
        jawaban.every(val => question.answer.includes(val))
      ) {
        earnedPoints += skor;
      }
    } else if (question.type === "matrix") {
      let benar = 0;
      if (jawaban) {
        question.answer.forEach((kunci, i) => {
          if (jawaban[i] === kunci) benar++;
        });
      }
      const skorPerBaris = skor / question.answer.length;
      earnedPoints += benar * skorPerBaris;
    }
  });

  document.getElementById("totalPoints").textContent = totalPoints;
  document.getElementById("earnedPoints").textContent = earnedPoints.toFixed(2);
  showPage("results");
}

</script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'96a6e5374265f46d',t:'MTc1NDQwMzIwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener) document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState && ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    
let examQuestions = {};
let questions = [];
let currentQuestion = 0;
let answers = [];
let currentExam = "";

// Load soal.json
fetch('soal.json')
  .then(res => res.json())
  .then(data => {
    // Kelompokkan berdasarkan kategori
    examQuestions = data.reduce((acc, soal) => {
      const kategori = soal.kategori || "umum";
      if (!acc[kategori]) acc[kategori] = [];
      acc[kategori].push(soal);
      return acc;
    }, {});
  })
  .catch(err => {
    alert("Gagal memuat soal.");
    console.error(err);
  });

// Menampilkan soal
function startExam(subject) {
  currentExam = subject;
  questions = examQuestions[subject];
  if (!questions || questions.length === 0) {
    alert("Soal belum tersedia untuk kategori ini.");
    return;
  }
  answers = new Array(questions.length);
  currentQuestion = 0;
  showPage("exam");
  renderQuestion();
}

// Render soal
function renderQuestion() {
  const q = questions[currentQuestion];
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  const el = document.createElement("div");
  el.classList = "space-y-4";

  el.innerHTML += `<div class='font-semibold'>${q.question}</div>`;
  if (q.image) el.innerHTML += `<img src="${q.image}" class="w-40">`;

  if (q.type === "single") {
    q.options.forEach((opt, idx) => {
      el.innerHTML += \`
        <label class="block">
          <input type="radio" name="answer" value="\${idx}" onchange="answers[\${currentQuestion}] = parseInt(this.value)" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "multiple") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    q.options.forEach((opt, idx) => {
      const checked = answers[currentQuestion].includes(idx) ? "checked" : "";
      el.innerHTML += \`
        <label class="block">
          <input type="checkbox" value="\${idx}" \${checked}
            onchange="toggleCheckboxAnswer(\${idx})" />
          \${opt}
        </label>
      \`;
    });
  } else if (q.type === "matrix") {
    answers[currentQuestion] = answers[currentQuestion] || [];
    let table = "<table class='table-auto border w-full text-sm'><thead><tr><th class='border px-2'>Pernyataan</th>";
    q.options.forEach(opt => {
      table += \`<th class='border px-2'>\${opt}</th>\`;
    });
    table += "</tr></thead><tbody>";
    q.statements.forEach((stmt, rowIdx) => {
      table += \`<tr><td class='border px-2'>\${stmt}</td>\`;
      q.options.forEach((opt, colIdx) => {
        table += \`
          <td class='border px-2 text-center'>
            <input type="radio" name="matrix-\${rowIdx}" value="\${colIdx}" 
              onchange="setMatrixAnswer(\${currentQuestion}, \${rowIdx}, \${colIdx})"
              \${answers[currentQuestion][rowIdx] === colIdx ? "checked" : ""}>
          </td>\`;
      });
      table += "</tr>";
    });
    table += "</tbody></table>";
    el.innerHTML += table;
  }

  container.appendChild(el);
}

function toggleCheckboxAnswer(idx) {
  const current = answers[currentQuestion] || [];
  const i = current.indexOf(idx);
  if (i > -1) {
    current.splice(i, 1);
  } else {
    current.push(idx);
  }
  answers[currentQuestion] = current;
}

function setMatrixAnswer(qIdx, rowIdx, colIdx) {
  answers[qIdx][rowIdx] = colIdx;
}

// Navigasi
function nextQuestion() {
  if (currentQuestion < questions.length - 1) {
    currentQuestion++;
    renderQuestion();
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    renderQuestion();
  }
}

// Submit dan nilai
function submitExam() {
  let totalPoints = 0;
  let earnedPoints = 0;

  questions.forEach((question, index) => {
    const skor = question.score || 1;
    totalPoints += skor;
    const jawaban = answers[index];

    if (question.type === "single") {
      if (jawaban === question.answer) earnedPoints += skor;
    } else if (question.type === "multiple") {
      if (
        Array.isArray(jawaban) &&
        Array.isArray(question.answer) &&
        jawaban.length === question.answer.length &&
        jawaban.every(val => question.answer.includes(val))
      ) {
        earnedPoints += skor;
      }
    } else if (question.type === "matrix") {
      let benar = 0;
      if (jawaban) {
        question.answer.forEach((kunci, i) => {
          if (jawaban[i] === kunci) benar++;
        });
      }
      const skorPerBaris = skor / question.answer.length;
      earnedPoints += benar * skorPerBaris;
    }
  });

  document.getElementById("totalPoints").textContent = totalPoints;
  document.getElementById("earnedPoints").textContent = earnedPoints.toFixed(2);
  showPage("results");
}

</script>
  </body>
</html>
