<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Ujian Online - EduTest</title>
    <!-- Memuat library Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Google Fonts -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      /* Menambahkan kelas 'hidden' untuk menyembunyikan elemen */
      .hidden {
        display: none;
      }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Halaman Login (Gunakan flex untuk menengahkan) -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
        <div class="text-center mb-8">
          <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-white text-2xl font-bold">ðŸ“š</span>
          </div>
          <h1 class="text-2xl font-bold text-gray-800">EduTest Online</h1>
          <p class="text-gray-600 mt-2">Sistem Ujian Online</p>
        </div>

        <form id="loginForm" class="space-y-6">
          <div>
            <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
            <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username" required />
          </div>
          <div>
            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
            <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password" required />
          </div>
          <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">Masuk</button>
        </form>
      </div>
    </div>

    <!-- Halaman Dashboard (Awalnya tersembunyi) -->
    <div id="dashboard" class="hidden min-h-screen">
      <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4">
          <div class="flex justify-between items-center h-16">
            <span class="text-xl font-bold text-gray-800">EduTest Dashboard</span>
            <div>
              <span class="text-gray-600">Halo, <span id="studentName" class="font-medium"></span></span>
              <button onclick="logout()" class="ml-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Keluar</button>
            </div>
          </div>
        </div>
      </nav>
      <div class="max-w-7xl mx-auto p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">Pilih Ujian</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="font-bold text-gray-800">Bahasa Indonesia</h3>
                <button onclick="startExam('Bahasa Indonesia')" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Ujian</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="font-bold text-gray-800">Ilmu Pengetahuan Sosial</h3>
                <button onclick="startExam('ips')" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Ujian</button>
            </div>
             <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="font-bold text-gray-800">Pendidikan Kewarganegaraan</h3>
                <button onclick="startExam('pkn')" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mulai Ujian</button>
            </div>
        </div>
      </div>
    </div>

    <!-- Halaman Ujian (Awalnya tersembunyi) -->
    <div id="examPage" class="hidden p-8">
        <h2 id="examTitle" class="text-2xl font-bold mb-4">Ujian</h2>
        <div id="questionContainer" class="bg-white p-6 rounded-lg shadow-md"></div>
        <div class="mt-4 flex justify-between">
            <button onclick="prevQuestion()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Sebelumnya</button>
            <button onclick="nextQuestion()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Selanjutnya</button>
        </div>
        <button onclick="submitExam()" class="mt-6 w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">Selesaikan Ujian</button>
    </div>

    <!-- Halaman Hasil (Awalnya tersembunyi) -->
    <div id="resultsPage" class="hidden p-8 text-center">
        <h2 class="text-3xl font-bold">Hasil Ujian</h2>
        <p class="mt-4">Total Poin Anda: <span id="earnedPoints" class="font-bold">0</span> / <span id="totalPoints" class="font-bold">0</span></p>
        <button onclick="backToDashboard()" class="mt-6 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Kembali ke Dashboard</button>
    </div>

    <!-- =============================================== -->
    <!-- SEMUA KODE JAVASCRIPT DIKUMPULKAN DI SINI -->
    <!-- =============================================== -->
    <script>
        // --- VARIABEL GLOBAL ---
        let examQuestions = {};
        let questions = [];
        let currentQuestion = 0;
        let answers = [];
        let currentExam = "";

        // --- FUNGSI UTAMA ---

        function showPage(pageId) {
            const pages = ["loginPage", "dashboard", "examPage", "resultsPage"];
            pages.forEach(page => {
                const element = document.getElementById(page);
                if (page === pageId) {
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                }
            });
        }
        
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();

            fetch("users.json")
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(users => {
                    const user = users.find(u => u.username === username && u.password === password);
                    if (user) {
                        document.getElementById("studentName").textContent = user.username;
                        showPage("dashboard");
                    } else {
                        alert("Username atau password salah!");
                    }
                })
                .catch(error => {
                    console.error("Gagal memuat atau memproses users.json:", error);
                    alert("Terjadi kesalahan saat mencoba login.");
                });
        }

        function logout() {
            showPage("loginPage");
            document.getElementById("loginForm").reset();
        }

        function startExam(subject) {
            currentExam = subject;
            questions = examQuestions[subject];
            if (!questions || questions.length === 0) {
                alert("Soal untuk kategori ini belum tersedia.");
                return;
            }
            answers = new Array(questions.length).fill(undefined);
            currentQuestion = 0;
            document.getElementById('examTitle').textContent = `Ujian ${subject.toUpperCase()}`;
            renderQuestion();
            showPage("examPage");
        }
        
        function renderQuestion() {
            if (currentQuestion >= questions.length) return;
            const q = questions[currentQuestion];
            const container = document.getElementById("questionContainer");
            container.innerHTML = "";

            const el = document.createElement("div");
            el.className = "space-y-4";
            
            let questionHTML = `Soal ${currentQuestion + 1}: ${q.question}`;

            if (q.image && questionHTML.includes('[GAMBAR]')) {
                // PERUBAHAN DI SINI: Menghapus "images/" dari path
                const imgTag = `<img src="${q.image}" alt="Gambar Soal" class="my-4 w-full max-w-sm mx-auto rounded-lg shadow-md">`;
                questionHTML = questionHTML.replace('[GAMBAR]', imgTag);
            }
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'font-semibold text-lg';
            questionDiv.innerHTML = questionHTML;
            el.appendChild(questionDiv);

            if (q.type === "single") {
                q.options.forEach((opt, idx) => {
                    const label = document.createElement('label');
                    label.className = 'block p-3 border rounded-lg hover:bg-gray-100';
                    label.innerHTML = `<input type="radio" name="answer" value="${idx}" onchange="saveSingleAnswer(${idx})" ${answers[currentQuestion] == idx ? 'checked' : ''}> ${opt}`;
                    el.appendChild(label);
                });
            } else if (q.type === "multiple") {
                 q.options.forEach((opt, idx) => {
                    const label = document.createElement('label');
                    label.className = 'block p-3 border rounded-lg hover:bg-gray-100';
                    const isChecked = answers[currentQuestion] && answers[currentQuestion].includes(idx);
                    if (typeof opt === 'object' && opt.image) {
                        // PERUBAHAN DI SINI: Menghapus "images/" dari path opsi
                        label.innerHTML = `<input type="checkbox" value="${idx}" onchange="toggleMultipleAnswer(${idx})" ${isChecked ? 'checked' : ''}> <img src="${opt.image}" class="inline h-6 w-6 mr-2">${opt.text}`;
                    } else {
                        label.innerHTML = `<input type="checkbox" value="${idx}" onchange="toggleMultipleAnswer(${idx})" ${isChecked ? 'checked' : ''}> ${opt}`;
                    }
                    el.appendChild(label);
                });
            }

            container.appendChild(el);
        }

        function saveSingleAnswer(index) {
            answers[currentQuestion] = index;
        }

        function toggleMultipleAnswer(index) {
            if (!Array.isArray(answers[currentQuestion])) {
                answers[currentQuestion] = [];
            }
            const currentAnswers = answers[currentQuestion];
            const answerIndex = currentAnswers.indexOf(index);
            if (answerIndex > -1) {
                currentAnswers.splice(answerIndex, 1);
            } else {
                currentAnswers.push(index);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function submitExam() {
            let totalPoints = 0;
            let earnedPoints = 0;

            questions.forEach((q, index) => {
                const score = q.score || 1;
                totalPoints += score;
                const userAnswer = answers[index];
                const correctAnswer = q.answer;

                let isCorrect = false;
                if (q.type === 'single') {
                    isCorrect = userAnswer === correctAnswer;
                } else if (q.type === 'multiple') {
                    if (Array.isArray(userAnswer) && Array.isArray(correctAnswer)) {
                        isCorrect = userAnswer.length === correctAnswer.length && userAnswer.every(val => correctAnswer.includes(val));
                    }
                }

                if (isCorrect) {
                    earnedPoints += score;
                }
            });

            document.getElementById("totalPoints").textContent = totalPoints;
            document.getElementById("earnedPoints").textContent = earnedPoints;
            showPage("resultsPage");
        }
        
        function backToDashboard() {
            showPage("dashboard");
        }

        document.addEventListener('DOMContentLoaded', () => {
            showPage('loginPage');

            document.getElementById("loginForm").addEventListener("submit", handleLogin);
            
            fetch('soal.json')
                .then(res => res.json())
                .then(data => {
                    examQuestions = data.reduce((acc, soal) => {
                        const kategori = soal.kategori || "umum";
                        if (!acc[kategori]) acc[kategori] = [];
                        acc[kategori].push(soal);
                        return acc;
                    }, {});
                    console.log("Soal berhasil dimuat.");
                })
                .catch(err => {
                    alert("Gagal memuat soal ujian.");
                    console.error(err);
                });
        });
    </script>
</body>
</html>
